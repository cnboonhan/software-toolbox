#!/bin/bash
set -e

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
DOTFILES_DIR=$SCRIPT_DIR/../dotfiles

echo "vim installation"
sudo apt update 

echo "adding ppas and update"
sudo add-apt-repository ppa:jonathonf/vim -y
sudo apt update 

echo "installing apt dependencies"
sudo apt install vim -y
sudo apt install default-jdk -y
sudo apt install build-essential cmake python3-dev -y
sudo apt install python3-pip -y
sudo apt install libncurses5 -y # Fixes some Clangd issues on Raspberry Pi
sudo apt install flake8 -y
sudo apt install python3-pip -y
sudo apt install vim-gtk -y # For copying to system clipboard
sudo apt install clang-format -y
pip3 install --upgrade autopep8
pip3 install doq

echo "dependencies installation complete"

echo "installing pip binaries"
sudo -H pip3 install pynvim

# Vim-Plug for plugin management
[ -d "$HOME/.vim" ] && yes | rm -r $HOME/.vim
curl -fLo $HOME/.vim/autoload/plug.vim --create-dirs \
      https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
echo "vim-plug complete"

echo "installing vim plugins"
cp $SCRIPT_DIR/../dotfiles/.minimal_vimrc $HOME/.vimrc
/usr/bin/vim -c ':PlugInstall' -c ':qall' 
cp $SCRIPT_DIR/../dotfiles/.vimrc $HOME
echo "vim plugins complete"
